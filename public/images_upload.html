<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이미지 업로드</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 파비콘 아이콘들 (상대경로(./) 사용 -->
    <link rel="icon" href="./favicon.ico?v=2" />

    <link
      rel="icon"
      type="image/png"
      sizes="36x36"
      href="./favicons/android-icon-36x36.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="./favicons/android-icon-48x48.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="72x72"
      href="./favicons/android-icon-72x72.png"
    />

    <link
      rel="apple-touch-icon"
      sizes="32x32"
      href="./favicons/apple-icon-32x32.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="./favicons/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="./favicons/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="./favicons/apple-icon-72x72.png"
    />

    <!-- 웹사이트 매니페스트 (상대경로(./) 사용  -->
    <link rel="manifest" href="./manifest.json" />

    <!-- Ms브라우저 설정 파일 (상대경로(./) 사용  -->
    <meta name="msapplication-config" content="./browserconfig.xml" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="./ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">


</head>

<body>
  <h2>이미지 업로드</h2>

  <label>이미지 선택:</label><br>
  <input type="file" id="imageFile"><br><br>

  <label>요약 입력:</label>
  <input type="text" id="summary"><br><br>

  <button id="uploadBtn">업로드하기</button>

  <p id="status"></p>

  <script type="module">
    import { db, storage } from "./firebase-config.js";
    import { ref, push, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { ref as sRef, uploadBytes, getDownloadURL }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const uploadBtn = document.getElementById("uploadBtn");
    const status = document.getElementById("status");

    uploadBtn.addEventListener("click", async () => {
      const file = document.getElementById("imageFile").files[0];
      const summary = document.getElementById("summary").value;

      if (!file) return alert("이미지를 선택해주세요.");

      const today = new Date();
      const month = today.getMonth() + 1;
      const formattedDate = today.toISOString().slice(0, 16).replace("T", " ");

      // Firebase Storage 업로드
      const storageRef = sRef(storage, "images/" + file.name);
      await uploadBytes(storageRef, file);
      const downloadURL = await getDownloadURL(storageRef);

      // Firebase DB에 저장
      const imagesRef = ref(db, "images");
      const newPost = push(imagesRef);

      await set(newPost, {
        month: month,
        date: formattedDate,
        summary: summary,
        imageUrl: downloadURL
      });

      status.textContent = "업로드 완료!";
    });
  </script>
</body>
</html>
