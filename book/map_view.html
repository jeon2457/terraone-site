<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<!-- ëª¨ë°”ì¼ í™”ë©´ ê½‰ ì°¨ê²Œ ì„¤ì • -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì°¾ì•„ì˜¤ëŠ” ê¸¸ì•ˆë‚´</title>

<!-- âœ… ì¹´ì¹´ì˜¤ë§µ API í‚¤ í™•ì¸ í•„ìˆ˜ -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3409644aa1cb50eb41430562f5df97d2&libraries=services"></script>

<style>
/* CSS ì´ˆê¸°í™” */
* { box-sizing: border-box; }
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: 'Noto Sans KR', sans-serif;
  overflow: hidden;
}

.map-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

#map {
  width: 100%;
  height: 100%;
}

/* ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ë°•ìŠ¤ */
.navi-buttons {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 400px;
  display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
  gap: 10px;
  z-index: 9999;
}

/* ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-navi {
  flex: 1;
  padding: 12px; /* íŒ¨ë”© ì•½ê°„ ì¡°ì ˆ */
  border-radius: 12px;
  text-decoration: none;
  font-weight: bold;
  font-size: 16px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  transition: transform 0.2s;
  
  /* ğŸ”¥ [ìˆ˜ì •ë¨] ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ê°€ë¡œ ì •ë ¬ */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px; /* ì´ë¯¸ì§€ì™€ ê¸€ì ì‚¬ì´ ê°„ê²© */
  cursor: pointer;
}

.btn-navi:active {
  transform: scale(0.96);
}

/* ğŸ”¥ [ì¶”ê°€ë¨] ë²„íŠ¼ ë‚´ë¶€ ì•„ì´ì½˜ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
.btn-icon {
  width: 24px;  /* ì•„ì´ì½˜ í¬ê¸° */
  height: 24px;
  object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€ */
  border-radius: 4px; /* ëª¨ì„œë¦¬ ì‚´ì§ ë‘¥ê¸€ê²Œ */
}

/* ì¹´ì¹´ì˜¤ë§µ (ë…¸ë‘) */
.btn-kakao {
  background-color: #FEE500;
  color: #3C1E1E;
  border: 1px solid #eecbf0;
}

/* TMAP (í°ìƒ‰/ê²€ì •) */
.btn-tmap {
  background-color: #FFFFFF;
  color: #000000;
  border: 1px solid #ccc;
}

/* ëª¨ë‹¬ì°½ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 10000;
  justify-content: center;
  align-items: center;
}
.modal-box {
  background: white;
  padding: 25px;
  border-radius: 15px;
  width: 85%;
  max-width: 320px;
  text-align: center;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}
.modal-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333; }
.modal-desc { font-size: 14px; color: #666; margin-bottom: 20px; line-height: 1.5; }
.modal-btns { display: flex; gap: 10px; }
.modal-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
.btn-cancel { background: #f1f1f1; color: #555; }
.btn-install { background: #ff4d4d; color: white; }
</style>
</head>

<body>
<div class="map-wrapper">
  <div id="map"></div>

  <!-- ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
  <div class="navi-buttons" id="naviBox">
    <!-- âœ… ì¹´ì¹´ì˜¤ë§µ ë²„íŠ¼ (ì´ë¯¸ì§€ êµì²´) -->
    <a href="#" id="kakaoLink" class="btn-navi btn-kakao" target="_blank">
      <img src="image/kakao_map.png" alt="kakao" class="btn-icon">
      ì¹´ì¹´ì˜¤ë§µ
    </a>
    
    <!-- âœ… TMAP ë²„íŠ¼ (ì´ë¯¸ì§€ êµì²´) -->
    <div id="tmapLink" class="btn-navi btn-tmap" onclick="tryRunTmap()">
      <img src="image/t_map.jpg" alt="tmap" class="btn-icon">
      TMAP ì‹¤í–‰
    </div>
  </div>
</div>

<!-- ì•ˆë‚´ ëª¨ë‹¬ì°½ -->
<div id="tmapModal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-title">ğŸ“¢ ì•ˆë‚´</div>
    <div class="modal-desc">
      TMAP ì•±ì´ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      ì„¤ì¹˜ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
    </div>
    <div class="modal-btns">
      <button class="modal-btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="modal-btn btn-install" onclick="goToStore()">ì„¤ì¹˜í•˜ëŸ¬ ê°€ê¸°</button>
    </div>
  </div>
</div>

<script>
// 1. ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
const address = localStorage.getItem('weddingAddress');

if (!address) {
  alert('ì…ë ¥ëœ ì£¼ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.');
}

const mapContainer = document.getElementById('map');
const mapOption = {
  center: new kakao.maps.LatLng(37.5665, 126.9780),
  level: 3
};

const map = new kakao.maps.Map(mapContainer, mapOption);
const geocoder = new kakao.maps.services.Geocoder();
const marker = new kakao.maps.Marker({ map });

// TMAP ë§í¬ ë³€ìˆ˜
let tmapUrlScheme = "";

// 2. ì¢Œí‘œ ê²€ìƒ‰ ë° ë§í¬ ìƒì„±
if (address) {
  geocoder.addressSearch(address, function(result, status) {
    if (status === kakao.maps.services.Status.OK) {
      const lat = result[0].y;
      const lng = result[0].x;
      const coords = new kakao.maps.LatLng(lat, lng);

      map.setCenter(coords);
      marker.setPosition(coords);

      new kakao.maps.InfoWindow({
        content: `<div style="width:150px;text-align:center;padding:6px 0;font-size:14px;">${address}</div>`
      }).open(map, marker);

      // --- ë§í¬ ì„¤ì • ---
      const naviBox = document.getElementById('naviBox');
      const kakaoBtn = document.getElementById('kakaoLink');

      // ì¹´ì¹´ì˜¤ë§µ
      kakaoBtn.href = `https://map.kakao.com/link/to/${address},${lat},${lng}`;

      // TMAP
      tmapUrlScheme = `tmap://route?goalname=${encodeURIComponent(address)}&goalx=${lng}&goaly=${lat}`;

      // ë²„íŠ¼ í‘œì‹œ
      naviBox.style.display = 'flex'; 

    } else {
      alert("ì£¼ì†Œ ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  });
}

// 3. TMAP ì‹¤í–‰ ë¡œì§
function tryRunTmap() {
  if (!tmapUrlScheme) return;

  const startTime = new Date().getTime();
  window.location.href = tmapUrlScheme;

  setTimeout(function() {
    const endTime = new Date().getTime();
    if (endTime - startTime < 2500) {
      showModal();
    }
  }, 1500);
}

function showModal() { document.getElementById('tmapModal').style.display = 'flex'; }
function closeModal() { document.getElementById('tmapModal').style.display = 'none'; }

function goToStore() {
  const userAgent = navigator.userAgent.toLowerCase();
  if (userAgent.indexOf("android") > -1) {
    window.location.href = "market://details?id=com.skt.tmap.ku"; 
  } else if (userAgent.indexOf("iphone") > -1 || userAgent.indexOf("ipad") > -1) {
    window.location.href = "https://apps.apple.com/kr/app/tmap-%EB%8C%80%EC%A4%91%EA%B5%90%ED%86%B5-%EB%8C%80%EB%A6%AC%EC%9A%B4%EC%A0%84/id431589174";
  } else {
    alert("ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œë§Œ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
  }
  closeModal();
}
</script>
</body>
</html>