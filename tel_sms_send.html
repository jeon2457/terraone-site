<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë‹¨ì²´ ë¬¸ì ë°œì†¡</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: #f5f6fa; }

.scroll-box {
  border: 1px solid #e6e9ee;
  border-radius: 10px;
  padding: 10px;
  max-height: 700px;
  overflow-y: auto;
  background: #fafafa;
}

.grid-box {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.grid-item {
  background: white;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  font-size: 0.9rem;
  line-height: 1.4rem;
  border: 1px solid #eee;
}

.controls {
  margin-top: 20px;
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

.title {
  text-align: center;
  background: #f0f4ff;
  padding: 16px 0;
  margin: 20px auto 30px auto;
  width: 90%;
  max-width: 500px;
  border-radius: 25px;
  font-size: 1.4rem;
  font-weight: 700;
  color: #2a3d7c;
}

.count {
  text-align: center;
  font-size: 1rem;
}

.count .number {
  color: #1a73e8;
  font-weight: 700;
}
</style>
</head>

<body>

<div class="container mt-3 mb-5">
  <div class="title">ë‹¨ì²´ ë¬¸ì ë°œì†¡</div>

  <div class="count mb-3">
    ë¬¸ìë©”ì‹œì§€ ë³´ë‚¼ ì¸ì›ìˆ˜:
    <span class="number" id="totalCount">0</span> ëª…
  </div>

  <div class="scroll-box">
    <div class="grid-box" id="memberList"></div>
  </div>

  <div class="controls">
    <button type="button" class="btn btn-primary" id="sendBtn">ë‹¨ì²´ë¬¸ìë³´ë‚´ê¸°</button>
    <button type="button" class="btn btn-secondary" onclick="history.back()">ëŒì•„ê°€ê¸°</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyAF7AD1d54k21-stmb0Hpg9OMEECvzFHpQ",
  authDomain: "terraone-d0318.firebaseapp.com",
  databaseURL: "https://terraone-d0318-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "terraone-d0318",
  storageBucket: "terraone-d0318.appspot.com",
  messagingSenderId: "1082807340877",
  appId: "1:1082807340877:web:6e2b49c04562d800e87104"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* URL íŒŒë¼ë¯¸í„° */
const params = new URLSearchParams(location.search);
const fromTel = params.get('from') || '';
const listParam = params.get('list') || '';

const targetNumbers = listParam
  .split(',')
  .map(n => n.trim())
  .filter(n => n && n !== fromTel);

const listBox = document.getElementById('memberList');
const totalCountEl = document.getElementById('totalCount');
const sendBtn = document.getElementById('sendBtn');

let members = [];
let smsNumbers = [];

const telRef = ref(db, 'terraone/tel');

onValue(telRef, (snapshot) => {
  members = [];
  smsNumbers = [];
  listBox.innerHTML = '';

  snapshot.forEach(child => {
    const m = child.val();
    if (!m.tel) return;
    if (!targetNumbers.includes(m.tel)) return;

    members.push({
      name: m.name || '',
      tel: m.tel,
      remark: m.remark || ''
    });
  });

  /* âœ… ì´ë¦„ ê¸°ì¤€ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬ */
  members.sort((a, b) => a.name.localeCompare(b.name, 'ko'));

  members.forEach((m, idx) => {
    smsNumbers.push(m.tel);

    const div = document.createElement('div');
    div.className = 'grid-item';
    div.innerHTML = `
      <strong>${idx + 1}. ${m.name}</strong><br>
      (${m.remark})<br>
      ğŸ“ ${m.tel}
    `;
    listBox.appendChild(div);
  });

  totalCountEl.textContent = smsNumbers.length;
});

/* ë¬¸ì ë°œì†¡ */
sendBtn.addEventListener('click', () => {
  if (smsNumbers.length === 0) {
    alert('ë°œì†¡í•  ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  if (!confirm(`${smsNumbers.length}ëª…ì—ê²Œ ë‹¨ì²´ë¬¸ìë¥¼ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  location.href = 'sms:' + smsNumbers.join(',');
});
</script>

</body>
</html>



<!-- 

// ğŸ‘‰ sms_2ë¥¼ ì•„ì˜ˆ ì—†ì• ê³  â€œì‹¤ì‹œê°„ ê³„ì‚°â€ ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ëŠ” êµ¬ì¡°ê°€ ë” ê°„ê²°í• ìˆ˜ë„ ìˆë‹¤.

// ğŸ”¥ ì•„ì£¼ ì¤‘ìš”í•œ íŒ (ê°•ë ¥ ì¶”ì²œ)

// ì¥ê¸°ì ìœ¼ë¡œëŠ” ë” ì•ˆì „í•œ êµ¬ì¡°:

// âŒ sms_2ì— ì „í™”ë²ˆí˜¸ë¥¼ ì €ì¥

// âœ… tel_sms_send.htmlì—ì„œ ê·¸ë•Œê·¸ë•Œ ì „ì²´ íšŒì› ì¡°íšŒ

// edit-member.js ì½”ë“œë„ ìˆ˜ì •ìš”êµ¬!

 -->